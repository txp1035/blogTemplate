---
title: '记一次小程序开发'
category: 技术
tags: [总结, 前端]
date: 2018-9-28
updated: 2018-9-28
---

第一次小程序开发。

<!-- more -->

# 统计

开始时间：2018.8.20
开发结束时间：2018.9.21
测试结束时间：2018.9.28
页面组件统计:32 个页面组件
公共组件统计:11 个公共组件
实际工作时间(包括加班):开发 271.5 小时，测试 67.5 小时

# 背景

第一次做手机端 APP，第一次使用小程序开发，第一次使用数据驱动做公司项目（原来用的 jQuery 进行 dom 操作）。

# 需求

按照 APP（商城类）开发小程序

# 详细经历

## 第一周

1. 像素单位用 rpx,2rpx ＝ 1px。
2. flex 垂直布局 margin-right 失效。

## 第二周

1. 问题：Java 后端返回 id 为 lang 类型，前端获取会丢失精度。
2. 创建了控制器文件夹，用来放与后端交互的接口(也不知道也没用)。
3. 用 promise 封装了常用的请求方法，做了统一错误处理，后台异常处理。

## 第三周

1. 发现有很多表单页面相似，于是封装了一个表单页面组件，通过给组件传入页面元素配置和验证规则实现复用。
2. 创建测试页面通过按钮的方式来测试后端接口是否有问题。
3. 移动端分页

## 第四周

1. 图片上传踩坑：刚开始：因为不能使用原生，通过查文档使用 wx.chooseImage 选择图片获取临时路径、把临时路径作为一个请求的 url，把数据返回格式设置成 arraybuffer 可以拿到图片 base64 格式提交给后端，这个方法在微信模拟器没什么问题，在真机上就会报错了。解决方案：wx.chooseImage 选择图片获取临时路径，readFile()读取文件获取 base64 格式编码。
2. 支付接口踩坑：刚开始：通过 wx.login()拿到 code，在访问腾讯地址拿到 openid，然后传给后端拿到掉支付接口需要的字段，最后掉起接口 wx.requestPayment()弹出微信支付界面，通过回调判断支付是否成功给后端反馈，这个方法有一个步骤出问题了，在微信开发工具中开启忽略验证不会有问题，上线了就会访问不了腾讯地址获取 openid，因为腾讯默认这个地址不合法。解决方案：获取 oppenid 这一步放到后端实现就可以解决。

# 需要改进的地方

## 关于错误处理

1. 后端返回错误码和提示信息统一处理（已有，通过弹窗形式提示错误信息），应该换种形式来区分前端写的提示信息。
